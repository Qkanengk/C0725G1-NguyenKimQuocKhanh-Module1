<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <table onclick="play" style="border-collapse: collapse; text-align: center">
      <tr></tr>
    </table>
    <p id="result"></p>
    <script>
      let arr = Array(9);
      for (let i = 0; i < arr.length; i++) {
        arr[i] = Array(9);
        for (let j = 0; j < arr[i].length; j++) {
          arr[i][j] = "";
        }
      }
      display();
      let isPlayerX = true;
      function play(i, j) {
        if (arr[i][j] === "") {
          if (isPlayerX) {
            arr[i][j] = "X";
            isPlayerX = false;
            display();
            if (checkWin()) {
              setTimeout(() => {
                alert("X win");
                reset();
              }, 80);
            }
          } else {
            arr[i][j] = "O";
            isPlayerX = true;
            display();
            if (checkWin()) {
              setTimeout(() => {
                alert("O win");
                reset();
              }, 80);
            }
          }
        } else alert("Ô này đã đánh rồi!");
      }

      function display() {
        let tableString = `<table style="border-collapse: collapse;">`;
        for (let i = 0; i < arr.length; i++) {
          tableString += `<tr>`;
          for (let j = 0; j < arr[i].length; j++) {
            tableString += `<td onclick="play(${i},${j})" style="border: 1px solid black; height: 40px; width: 40px; text-align: center;">${arr[i][j]}</td>`;
          }
          tableString += `</tr>`;
        }
        tableString += `</table>`;
        document.getElementById("result").innerHTML = tableString;
      }

      function checkWin() {
        const size = arr.length;
        for (let i = 0; i < size; i++) {
          for (let j = 0; j <= size - 4; j++) {
            if (
              arr[i][j] !== "" &&
              arr[i][j] === arr[i][j + 1] &&
              arr[i][j] === arr[i][j + 2] &&
              arr[i][j] === arr[i][j + 3]
            ) {
              return true;
            }
          }
        }
        for (let i = 0; i < size; i++) {
          for (let j = 0; j <= size - 4; j++) {
            if (
              arr[i][j] !== "" &&
              arr[i][j] === arr[i + 1][j] &&
              arr[i][j] === arr[i + 2][j] &&
              arr[i][j] === arr[i + 3][j]
            ) {
              return true;
            }
          }
        }
        for (let i = 0; i < size; i++) {
          for (let j = 0; j <= size - 4; j++) {
            if (
              arr[i][j] !== "" &&
              arr[i][j] === arr[i + 1][j + 1] &&
              arr[i][j] === arr[i + 2][j + 2] &&
              arr[i][j] === arr[i + 3][j + 3]
            ) {
              return true;
            }
          }
        }
        for (let i = 0; i < size; i++) {
          for (let j = 0; j <= size - 4; j++) {
            if (
              arr[i][j] !== "" &&
              arr[i][j] === arr[i + 1][j - 1] &&
              arr[i][j] === arr[i + 2][j - 2] &&
              arr[i][j] === arr[i + 3][j - 3]
            ) {
              return true;
            }
          }
        }
        for (let i = 3; i < size; i++) {
          for (let j = 0; j <= size - 4; j++) {
            if (
              arr[i][j] !== "" &&
              arr[i][j] === arr[i - 1][j + 1] &&
              arr[i][j] === arr[i - 2][j + 2] &&
              arr[i][j] === arr[i - 3][j + 3]
            ) {
              return true;
            }
          }
        }
        return false;
      }

      function reset() {
        for (let i = 0; i < arr.length; i++) {
          arr[i] = Array(9);
          for (let j = 0; j < arr[i].length; j++) {
            arr[i][j] = "";
          }
        }
        display();
      }
    </script>
  </body>
</html>
